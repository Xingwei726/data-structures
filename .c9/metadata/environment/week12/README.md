{"filter":false,"title":"README.md","tooltip":"/week12/README.md","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":129,"column":3},"action":"remove","lines":["# Weekly Assignment 10","","## Assignment Description","This weekly assignment is to create a web server application in Node.js that will respond to various requests for JSON data for AA meetings, process blog entries, and sensor readings. The outcome does not include html elements or css styles yet, it just a representation of the queries.","","**Link to the app:** http://3.85.39.185:8080","","## Preparation","Build on what I've worked on in class, I reorganized the file so the first step was to install express and include all the credentials that's needed for both PostgreSQL and Dynamo DB.  Then connect the client with these credentials.","","```Javascript","var express = require('express'), // npm install express","    app = express();","","//1.process blog credentials    ","var AWS = require('aws-sdk');","AWS.config = new AWS.Config();","AWS.config.region = \"us-east-1\";","// app.use(require(\"cors\")()) // allow Cross-domain requests ","// app.use(require('body-parser').json()) ","","//2&3. sensor and aa data noSQL credentials","const { Client } = require('pg');","const dotenv = require('dotenv');","dotenv.config({path: '/home/ec2-user/environment/week10/.env'});","","const db_credentials = new Object({","  user: \"huanx429\",","  password: process.env.AWSRDS_PW,","  host: process.env.AWSRDS_EP,","  database: \"aa\",","  port: 5432,","});","","const client = new Client(db_credentials);","client.connect();","","```","","## Create Homepage","Then I used following code to create a homepage which references to the three details pages.","","```javascript","//0. Homepage","app.get('/', function(req, res) {","    res.send(`<h1>Data Structure</h1>","              <ul>","                  <li><a href=\"/processblog\"> Process Blog</a></li>","                  <li><a href=\"/sensor\"> Sensor Data</a></li>","                  <li><a href=\"/aalocation\"> AA Data</a></li>","              </ul>`);    ","});","```","","","## Process Blog Query (Dynamo DB)","For the process blog data I used following code to query all the process blogs under partition key  'calm'.","```javascript","//1. Process Blog Data Query (noSQL)","app.get('/processblog', function(req, res) {","   ","   var dynamodb = new AWS.DynamoDB();","   var params = {","        TableName : \"processblog\",","        KeyConditionExpression: \"#tp = :patitionKey\",","        ExpressionAttributeNames: {","            \"#tp\" : \"mood\",","        },","        ExpressionAttributeValues: {","            \":patitionKey\": {S: \"Calm\"},","        }","    };","   dynamodb.query(params, function(err, data) {","        if (err) {","            console.error(\"Unable to query. Error:\", JSON.stringify(err, null, 2));","        } else {","            console.log(\"Query succeeded.\");","            //Get all process blog under mood 'calm'","            res.send(data);","        }","    });","});","```","","","## Sensor Data Query (PostgreSQL)","For my sensor data I used the following code to query all the temperature from my sensor table.","```javascript","//2. Sensor Data (SQL) Query","app.get('/sensor', function(req, res) {","    // res.send('<h3>this is the page for my sensor data</h3>'); ","        res.send(sensor);","});","// Different SQL queries for sensor data: ","// var thisQuery = \"SELECT sensorValue, sensorTemp FROM sensorData;\"; // print all values","var thisQuery = \"SELECT * FROM sensorData;\"; // print all values","// var secondQuery = \"SELECT COUNT (*) FROM sensorData;\"; // print the number of rows","// var thirdQuery = \"SELECT sensorValue, COUNT (*) FROM sensorData GROUP BY sensorValue;\"; // print the number of rows for each sensorValue","","client.query(thisQuery, (err, res) => {","    if (err) {throw err}","    else {","        console.table(res.rows);","        sensor.push(res.rows);","        // client.end();","    }","});","","```","","## AA Meetings Query (PostgreSQL)","And for my AA meetings data I query the locationTitle, meetingName, meetingDay, meetingType, TimeStart from aameetings database where the meetingDay = 'Tuesdays' and meetingType = 'O'\". Because in my UI design, users can use the filter section to choose a specific meeting based on their required meetingDay and meeting Type. Return result is 8 meetings which fit into these restrictions.","```javascript","//3. AA Data Query","app.get('/aalocation', function(req, res) {","    // res.send('<h3>this is the page for my sensor data</h3>'); ","        res.send(aa);","});","//Get LocationTitle from aa data base","var thisQuery = \"SELECT locationTitle, meetingName, meetingDay, meetingType, TimeStart FROM aameetings WHERE meetingDay = 'Tuesdays' AND meetingType = 'O'\";","","client.query(aaQuery, (err, res) => {","    if (err) {throw err}","    else {","        console.table(res.rows);","        aa.push(res.rows);","        client.end();","    }","});","```"],"id":2}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1575131042824,"hash":"f715713fadea0cc8a078192f74e33097e125caad"}