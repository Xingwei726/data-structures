{"filter":false,"title":"week03_2.js","tooltip":"/week3/week03_2.js","undoManager":{"mark":53,"position":53,"stack":[[{"start":{"row":0,"column":0},"end":{"row":128,"column":1},"action":"insert","lines":["//  Neil Oliver","//  Week 03 Data Structures Task","//  Add geographic info to parsed data","","// dependencies","var request = require('request'); // npm install request","var async = require('async'); // npm install async","var fs = require('fs');","const dotenv = require('dotenv'); // npm install dotenv","var cheerio = require('cheerio')","","// TAMU api key","dotenv.config();","const apiKey = process.env.TAMU_KEY;","","var meetings = {};","","// Read text file with saved HTML data","fs.readFile('/home/ec2-user/environment/week01/data/AA-data-07.txt', 'utf8', (error, data) => {","    if (error) throw error;","          ","    // Load the file data into the cheerio parser","    const $ = cheerio.load(data);","    ","    // Traverse the DOM model produced by Cheerio down three table rows deep","    $('tr tr tr').each(function(i, item) {","        if (i != 0){","            //Extract meeting name","            var meetingName = $(this).children().eq(0).find('b').text();","            meetingName = meetingName.split(' - ')","            meetingName = meetingName[0].toLowerCase()","            ","            //Extract if Wheelchair access is available","            var access = false","            if ($(this).children().eq(0).find('span').text().trim() == \"Wheelchair access\"){","               access = true ","            }","","            // Delete additional html code within the table row","            $(this).children().eq(0).find('div').remove().html();","            $(this).children().eq(0).find('b').remove().html();","            $(this).children().eq(0).find('span').remove().html();","            ","            // Extract the location details. Split at a new line, deleting white space and blank lines","            var location = $(this).children().eq(0).text().split(/\\n|,|\\(|\\)|-/).map(item => item.trim()).filter(Boolean);","            ","            // Replace E in address with East","            location[1] = location[1].replace(\" E \", \" East \");","            location[1] = location[1].replace(\" E. \", \" East \");","            ","            //Create an address object","            var addressObj = {","                line_1 : location[1],","                city : \"New York\",","                state : \"NY\",","                zip : location[location.length - 1].replace(/\\D+/g, ''),","                friendly: location.join(','),","                wheelchair_access: access,","            };","","            //If the meetings object does not contain this address, add it.","            if (!(meetings.hasOwnProperty(location[0]))){","                meetings[location[0]] = {","                    address : addressObj,","                    'meetings':{}","                };","            }","            ","            //Extract the meeting times into an array","            var meetingTimes = $(this).children().eq(1).text().split('\\n').map(item => item.trim()).filter(Boolean)","            ","            //For each meeting time, itterate through and extract the details into an object.","            for (let x = 0; x < meetingTimes.length; x++) { ","            ","                console.log(meetingTimes[x])","                var times = meetingTimes[x].split(' ')","                var timesObj = {","                    day : times[0],","                    start : times[3]+' '+times[4],","                    end : times[6]+' '+times[7],","                    type : times[10]","                }","                ","                //If the meeting has already been created, append the meeting times, else add the meeting and times.","                if (meetings[location[0]]['meetings'].hasOwnProperty(meetingName)) {","                    meetings[location[0]]['meetings'][meetingName].push(timesObj)","                } else {","                    meetings[location[0]]['meetings'][meetingName] = [timesObj]","                }","            };","            ","            //Call the geocode function","            getGeocode(location[0],addressObj)","        };","    });","});","","function getGeocode(name, address){","    //Check to see if the address already has the geocode before continue to save unneccesary API calls. ","    if (!(address.hasOwnProperty('geocode'))){","        //Set up the API request","        var apiRequest = 'https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderWebServiceHttpNonParsed_V04_01.aspx?';","        apiRequest += 'streetAddress=' + address.line_1.split(' ').join('%20');","        apiRequest += '&city=New%20York&state=NY&apikey=' + apiKey;","        apiRequest += '&format=json&version=4.01';","        ","        request(apiRequest, function(err, resp, body) {","            if (err) {throw err;}","            else {","                var tamuGeo = JSON.parse(body);","                //Extract the latitude and longitude","                var lat = tamuGeo['OutputGeocodes'][0]['OutputGeocode']['Latitude']","                var lon = tamuGeo['OutputGeocodes'][0]['OutputGeocode']['Longitude']","                ","                //Save a geocode object to the meetings object","                meetings[name]['address']['geocode'] = {","                    latitude : lat,","                    longitude : lon","                }","                ","                //Save the meetings object to file","                fs.writeFileSync('data/AA-data-07.json', JSON.stringify(meetings));","            }","        });","    } else {","        //Save the existing data to file","        fs.writeFileSync('data/AA-data-07.json', JSON.stringify(meetings));","    }","}"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":4,"column":0},"action":"remove","lines":["//  Neil Oliver","//  Week 03 Data Structures Task","//  Add geographic info to parsed data","",""],"id":2}],[{"start":{"row":14,"column":40},"end":{"row":14,"column":66},"action":"remove","lines":["week01/data/AA-data-07.txt"],"id":3},{"start":{"row":14,"column":40},"end":{"row":14,"column":53},"action":"insert","lines":["week1/m09.txt"]}],[{"start":{"row":97,"column":26},"end":{"row":97,"column":127},"action":"remove","lines":["https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderWebServiceHttpNonParsed_V04_01.aspx?"],"id":4},{"start":{"row":97,"column":26},"end":{"row":97,"column":127},"action":"insert","lines":["https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderWebServiceHttpNonParsed_V04_01.aspx?"]}],[{"start":{"row":122,"column":31},"end":{"row":122,"column":46},"action":"remove","lines":["AA-data-07.json"],"id":5},{"start":{"row":122,"column":31},"end":{"row":122,"column":40},"action":"insert","lines":["AA09.json"]}],[{"start":{"row":117,"column":39},"end":{"row":117,"column":54},"action":"remove","lines":["AA-data-07.json"],"id":6},{"start":{"row":117,"column":39},"end":{"row":117,"column":48},"action":"insert","lines":["AA09.json"]}],[{"start":{"row":5,"column":32},"end":{"row":5,"column":33},"action":"insert","lines":[";"],"id":7}],[{"start":{"row":52,"column":16},"end":{"row":52,"column":24},"action":"remove","lines":["friendly"],"id":8},{"start":{"row":52,"column":16},"end":{"row":52,"column":17},"action":"insert","lines":["d"]},{"start":{"row":52,"column":17},"end":{"row":52,"column":18},"action":"insert","lines":["a"]},{"start":{"row":52,"column":18},"end":{"row":52,"column":19},"action":"insert","lines":["t"]},{"start":{"row":52,"column":19},"end":{"row":52,"column":20},"action":"insert","lines":["i"]}],[{"start":{"row":52,"column":19},"end":{"row":52,"column":20},"action":"remove","lines":["i"],"id":9},{"start":{"row":52,"column":18},"end":{"row":52,"column":19},"action":"remove","lines":["t"]},{"start":{"row":52,"column":17},"end":{"row":52,"column":18},"action":"remove","lines":["a"]}],[{"start":{"row":52,"column":17},"end":{"row":52,"column":18},"action":"insert","lines":["e"],"id":10},{"start":{"row":52,"column":18},"end":{"row":52,"column":19},"action":"insert","lines":["t"]},{"start":{"row":52,"column":19},"end":{"row":52,"column":20},"action":"insert","lines":["a"]},{"start":{"row":52,"column":20},"end":{"row":52,"column":21},"action":"insert","lines":["i"]},{"start":{"row":52,"column":21},"end":{"row":52,"column":22},"action":"insert","lines":["l"]},{"start":{"row":52,"column":22},"end":{"row":52,"column":23},"action":"insert","lines":["s"]}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":3},"action":"insert","lines":["// "],"id":11}],[{"start":{"row":2,"column":33},"end":{"row":2,"column":53},"action":"remove","lines":["// npm install async"],"id":12}],[{"start":{"row":1,"column":33},"end":{"row":1,"column":56},"action":"remove","lines":[" // npm install request"],"id":13}],[{"start":{"row":4,"column":33},"end":{"row":4,"column":55},"action":"remove","lines":[" // npm install dotenv"],"id":14}],[{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"remove","lines":["// Read text file with saved HTML data",""],"id":15},{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"insert","lines":["// load the m09.txt file into into a cheerio object",""]}],[{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"remove","lines":["    // Load the file data into the cheerio parser",""],"id":17}],[{"start":{"row":15,"column":27},"end":{"row":16,"column":10},"action":"remove","lines":["","          "],"id":18}],[{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"remove","lines":["    // Traverse the DOM model produced by Cheerio down three table rows deep",""],"id":19}],[{"start":{"row":22,"column":50},"end":{"row":22,"column":51},"action":"insert","lines":[";"],"id":20}],[{"start":{"row":23,"column":54},"end":{"row":23,"column":55},"action":"insert","lines":[";"],"id":21}],[{"start":{"row":26,"column":30},"end":{"row":26,"column":31},"action":"insert","lines":[";"],"id":22}],[{"start":{"row":28,"column":29},"end":{"row":28,"column":30},"action":"insert","lines":[";"],"id":23}],[{"start":{"row":28,"column":29},"end":{"row":28,"column":30},"action":"remove","lines":[";"],"id":24},{"start":{"row":28,"column":28},"end":{"row":28,"column":29},"action":"remove","lines":[" "]}],[{"start":{"row":28,"column":28},"end":{"row":28,"column":29},"action":"insert","lines":[";"],"id":25}],[{"start":{"row":62,"column":115},"end":{"row":62,"column":116},"action":"insert","lines":[";"],"id":26}],[{"start":{"row":67,"column":44},"end":{"row":67,"column":45},"action":"insert","lines":[";"],"id":27}],[{"start":{"row":68,"column":54},"end":{"row":68,"column":55},"action":"insert","lines":[";"],"id":28}],[{"start":{"row":74,"column":17},"end":{"row":74,"column":18},"action":"insert","lines":[";"],"id":29}],[{"start":{"row":78,"column":81},"end":{"row":78,"column":82},"action":"insert","lines":[";"],"id":30}],[{"start":{"row":80,"column":79},"end":{"row":80,"column":80},"action":"insert","lines":[";"],"id":31}],[{"start":{"row":82,"column":13},"end":{"row":82,"column":14},"action":"remove","lines":[";"],"id":32}],[{"start":{"row":85,"column":46},"end":{"row":85,"column":47},"action":"insert","lines":[";"],"id":33}],[{"start":{"row":86,"column":9},"end":{"row":86,"column":10},"action":"remove","lines":[";"],"id":34}],[{"start":{"row":104,"column":83},"end":{"row":104,"column":84},"action":"insert","lines":[";"],"id":35}],[{"start":{"row":105,"column":84},"end":{"row":105,"column":85},"action":"insert","lines":[";"],"id":36}],[{"start":{"row":111,"column":17},"end":{"row":111,"column":18},"action":"insert","lines":[";"],"id":37}],[{"start":{"row":118,"column":0},"end":{"row":119,"column":0},"action":"remove","lines":["        //Save the existing data to file",""],"id":38}],[{"start":{"row":25,"column":14},"end":{"row":25,"column":25},"action":"remove","lines":["Extract if "],"id":39},{"start":{"row":25,"column":13},"end":{"row":25,"column":14},"action":"remove","lines":["/"]}],[{"start":{"row":25,"column":13},"end":{"row":25,"column":14},"action":"insert","lines":["/"],"id":40}],[{"start":{"row":25,"column":25},"end":{"row":25,"column":44},"action":"remove","lines":["access is available"],"id":41},{"start":{"row":25,"column":25},"end":{"row":25,"column":26},"action":"insert","lines":["A"]},{"start":{"row":25,"column":26},"end":{"row":25,"column":27},"action":"insert","lines":["c"]},{"start":{"row":25,"column":27},"end":{"row":25,"column":28},"action":"insert","lines":["c"]},{"start":{"row":25,"column":28},"end":{"row":25,"column":29},"action":"insert","lines":["e"]},{"start":{"row":25,"column":29},"end":{"row":25,"column":30},"action":"insert","lines":["s"]},{"start":{"row":25,"column":30},"end":{"row":25,"column":31},"action":"insert","lines":["s"]}],[{"start":{"row":20,"column":14},"end":{"row":20,"column":34},"action":"remove","lines":["Extract meeting name"],"id":42},{"start":{"row":20,"column":14},"end":{"row":20,"column":15},"action":"insert","lines":["M"]},{"start":{"row":20,"column":15},"end":{"row":20,"column":16},"action":"insert","lines":["e"]},{"start":{"row":20,"column":16},"end":{"row":20,"column":17},"action":"insert","lines":["e"]},{"start":{"row":20,"column":17},"end":{"row":20,"column":18},"action":"insert","lines":["t"]},{"start":{"row":20,"column":18},"end":{"row":20,"column":19},"action":"insert","lines":["i"]},{"start":{"row":20,"column":19},"end":{"row":20,"column":20},"action":"insert","lines":["n"]},{"start":{"row":20,"column":20},"end":{"row":20,"column":21},"action":"insert","lines":["g"]}],[{"start":{"row":20,"column":21},"end":{"row":20,"column":22},"action":"insert","lines":[" "],"id":43},{"start":{"row":20,"column":22},"end":{"row":20,"column":23},"action":"insert","lines":["N"]},{"start":{"row":20,"column":23},"end":{"row":20,"column":24},"action":"insert","lines":["a"]},{"start":{"row":20,"column":24},"end":{"row":20,"column":25},"action":"insert","lines":["m"]},{"start":{"row":20,"column":25},"end":{"row":20,"column":26},"action":"insert","lines":["e"]}],[{"start":{"row":31,"column":22},"end":{"row":31,"column":63},"action":"remove","lines":["additional html code within the table row"],"id":44},{"start":{"row":31,"column":22},"end":{"row":31,"column":23},"action":"insert","lines":["E"]},{"start":{"row":31,"column":23},"end":{"row":31,"column":24},"action":"insert","lines":["x"]},{"start":{"row":31,"column":24},"end":{"row":31,"column":25},"action":"insert","lines":["t"]},{"start":{"row":31,"column":25},"end":{"row":31,"column":26},"action":"insert","lines":["r"]},{"start":{"row":31,"column":26},"end":{"row":31,"column":27},"action":"insert","lines":["a"]}],[{"start":{"row":31,"column":27},"end":{"row":31,"column":28},"action":"insert","lines":[" "],"id":45},{"start":{"row":31,"column":28},"end":{"row":31,"column":29},"action":"insert","lines":["I"]},{"start":{"row":31,"column":29},"end":{"row":31,"column":30},"action":"insert","lines":["n"]},{"start":{"row":31,"column":30},"end":{"row":31,"column":31},"action":"insert","lines":["f"]},{"start":{"row":31,"column":31},"end":{"row":31,"column":32},"action":"insert","lines":["o"]},{"start":{"row":31,"column":32},"end":{"row":31,"column":33},"action":"insert","lines":["r"]},{"start":{"row":31,"column":33},"end":{"row":31,"column":34},"action":"insert","lines":["m"]},{"start":{"row":31,"column":34},"end":{"row":31,"column":35},"action":"insert","lines":["a"]},{"start":{"row":31,"column":35},"end":{"row":31,"column":36},"action":"insert","lines":["t"]},{"start":{"row":31,"column":36},"end":{"row":31,"column":37},"action":"insert","lines":["i"]}],[{"start":{"row":31,"column":37},"end":{"row":31,"column":38},"action":"insert","lines":["o"],"id":46},{"start":{"row":31,"column":38},"end":{"row":31,"column":39},"action":"insert","lines":["n"]}],[{"start":{"row":36,"column":0},"end":{"row":37,"column":0},"action":"remove","lines":["            // Extract the location details. Split at a new line, deleting white space and blank lines",""],"id":47},{"start":{"row":36,"column":0},"end":{"row":37,"column":0},"action":"insert","lines":["            // Information Reorganizing",""]}],[{"start":{"row":95,"column":49},"end":{"row":95,"column":55},"action":"remove","lines":["line_1"],"id":49},{"start":{"row":95,"column":49},"end":{"row":95,"column":60},"action":"insert","lines":["street_info"]}],[{"start":{"row":45,"column":16},"end":{"row":45,"column":22},"action":"remove","lines":["line_1"],"id":50},{"start":{"row":45,"column":16},"end":{"row":45,"column":27},"action":"insert","lines":["street_info"]}],[{"start":{"row":85,"column":47},"end":{"row":86,"column":0},"action":"insert","lines":["",""],"id":51},{"start":{"row":86,"column":0},"end":{"row":86,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":112,"column":18},"end":{"row":113,"column":0},"action":"insert","lines":["",""],"id":53},{"start":{"row":113,"column":0},"end":{"row":113,"column":16},"action":"insert","lines":["                "]}],[{"start":{"row":116,"column":43},"end":{"row":116,"column":44},"action":"insert","lines":["2"],"id":55}],[{"start":{"row":120,"column":35},"end":{"row":120,"column":36},"action":"insert","lines":["2"],"id":56}],[{"start":{"row":116,"column":43},"end":{"row":116,"column":44},"action":"remove","lines":["2"],"id":57}],[{"start":{"row":120,"column":35},"end":{"row":120,"column":36},"action":"remove","lines":["2"],"id":58}]]},"ace":{"folds":[],"scrolltop":1152.5,"scrollleft":0,"selection":{"start":{"row":61,"column":45},"end":{"row":61,"column":45},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":71,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1570632783559,"hash":"15911c8e5213f85d13ee90931ee6990d85849229"}